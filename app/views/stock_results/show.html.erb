<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-md-8">
      <h2>Picks for <%= @curr_day.strftime("%A %b %-d") %> </h2>

      <% if flash[:notice] %>
        <div class="notice"><%= flash[:notice] %></div>
      <% end %>

      <div class="btn-toolbar">
          &nbsp;
          <% if @curr_day <= User.first.created_at.at_midnight %>
            First | Previous
          <% else %>
            <a href="<%= url_for :controller => 'stock_results', :action => 'show', :day => prev_weekday(current_user.created_at).strftime("%Y%m%d") %>">First</a>
            | <a href="<%= url_for :controller => 'stock_results', :action => 'show', :day => prev_weekday(@curr_day).strftime("%Y%m%d") %>">Previous</a>
          <% end %>


          <% if @curr_day >= @max_date %>
            | Next | Last
          <% else %>
            | <a href="<%= url_for :controller => 'stock_results', :action => 'show', :day => next_weekday(@curr_day).strftime("%Y%m%d") %>">Next </a>
            | <a href="<%= root_url %>"> Last </a>
          <% end %>



      </div>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
          <tr>
            <th>Stock</th>
            <% if @market_open %>
              <th>Current</th>
            <% else %>
              <th>Closing Price</th>
            <% end %>
            <th>Locked In Price</th>
            <th>Prediction</th>
            <th>Result</th>
          </tr>
          </thead>
          <tbody>
          <% @results.each do |result| %>
            <tr>
              <td style="width:10%" ><%= result.stock %></td>
              <td style="width:25%" > <%= result.price %></td>
              <% if !result.stock_picks.first.nil? %>
                <td style="width:25%" ><%= result.stock_picks.first.assigned_price %></td>
                <td>
                  <div class="btn-group" style="width:100%">
                    <% ["up", "down"].each do |direction| %>
                        <% if direction == result.stock_picks.first.prediction %>
                          <%= link_to direction.upcase, "#", :style=>"float:left; width:50%; text-align:center", :class => "btn btn-info btn-default", :disabled=>"disabled" %>
                        <% else %>
                          <%= link_to direction.upcase, "#", :style=>"float:left; width:50%; text-align:center", :class => "btn btn-default", :disabled=>"disabled" %>
                        <% end %>
                    <% end %>
                  </div>
                </td>
                <td style="width:15%" ><%= result.stock_picks.first.result %></td>
              <% elsif !@allow_prediction %>
                <td style="width:25%" ></td>
                <td>
                  <div class="btn-group" style="width:100%">
                    <% ["up", "down"].each do |direction| %>
                        <%= link_to direction.upcase, "#", :style=>"float:left; width:50%; text-align:center", :class => "btn btn-default", :disabled=>"disabled" %>
                    <% end %>
                  </div>
                </td>
                <td style="width:15%" ></td>
              <% else %>
                <td style="width:25%" ></td>
                <td style="width:25%" >
                  <div class="btn-group" style="width:100%">
                    <% ["up", "down"].each do |direction| %>
                      <% form_id = "Form" + result.id.to_s + direction %>
                      <%= form_tag({:controller => "stock_picks", :action => "create"}, :id => form_id) do %>
                        <%= hidden_field_tag(:prediction, direction) %>
                        <%= hidden_field_tag(:stock_result_id, result.id) %>
                        <%= hidden_field_tag(:assigned_price, result.current_price) %>
                        <%= link_to direction.upcase, "#", :style=>"float:left; width:50%; text-align:center", :class => "btn btn-default", :onclick=>"$('#" + form_id + "').submit()" %>
                      <% end %>
                    <% end %>
                  </div>
                </td>
                <td style="width:15%" ></td>
              <% end %>

            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-xs-12 col-md-4">

      <h2>Leaderboard</h2>

      <div class="btn-toolbar">
        <div class="btn-group streak-btn-group">
          <a class="btn-current btn-info btn-default btn" href="javascript:displayOrder('current')">Current</a>
          <a class="btn-longest btn btn-default" href="javascript:displayOrder('longest');">Longest</a>
        </div>
      </div>

      <div class="table-responsive">
        <table class="current-streak streak table table-striped">
          <thead>
          <tr>
            <th>User</th>
            <th>Longest</th>
            <th>Current</th>
          </tr>
          </thead>
          <tbody>
          <% @current_leaders.each do |user| %>
            <tr>
              <td><%= user.name %></td>
              <td><%= user.max_streak %></td>
              <td><%= user.current_streak %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>

      <div class="table-responsive">
        <table style="display:none" class="longest-streak streak table table-striped">
          <thead>
          <tr>
            <th>User</th>
            <th>Longest</th>
            <th>Current</th>
          </tr>
          </thead>
          <tbody>
          <% @all_time_leaders.each do |user| %>
            <tr>
              <td><%= user.name %></td>
              <td><%= user.max_streak %></td>
              <td><%= user.current_streak %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>


<script>
  function displayOrder(selector)
  {
    var streakBtns = $(".streak-btn-group");
    $(".streak").hide();
    streakBtns.children(".btn").removeClass("btn-info");
    streakBtns.children("." +  selector + "-streak").show();
    streakBtns.children(".btn-" + selector).addClass("btn-info");

    $("." + selector + "-streak").show();
  }
</script>
